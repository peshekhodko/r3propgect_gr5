---
title: "Group 5, R Project 3"
author: "Kera Whitley, Laura Mathews, Nataliya Peshekhodko"
date: '`r format(Sys.Date(), "%Y-%B-%d")`'

abstract: "This project contains a hypothesis test for the observed data and a simulation study to compare the two hypothesis testing procedures."

output: pdf_document
---
```{r message=FALSE}
library(dplyr)
library (ggplot2)
library (gridExtra)
library (EnvStats)
library(ggpubr)
```

# First part


## 1.1. Read data
Read the data from txt file and save it in dataframe.

```{r}
data <- read.delim("mpg.txt", header=TRUE, sep=" ")
```


## 1.2. Two sample t-test

Conduct two sample t-test twice: with equal variance and with unequal veriance.
T-test with equal variance: 

```{r}
equal.var.test <- t.test( MPG~Country, data = data, var.equal=TRUE, conf.level=0.95)
equal.var.test
```

Based on the equal variance t.test **p-value=`r equal.var.test$p.value`** is small (less then 5% cut off), we can reject the null hypothesis. 

T-test with unequal variance: 

```{r}
unequal.var.test <- t.test( MPG~Country, data = data, var.equal=FALSE, conf.level = 0.95)
unequal.var.test
```

Based on the unequal variance t.test **p-value=`r unequal.var.test$p.value`** is small (less then 5% cut off), we also can reject the null hypothesis. 

## 1.3. How well the normality assumption met by the data

To test data for normality we will use 3 methods:

- Compare histogram of the data to a normal probability curve for the data
- Quantile-quantile plot
- Goodness of fit

First, split up data in two data sets based on the country. 
```{r message=FALSE}
us <- filter(data, Country == "US")
japan <- filter(data, Country == "Japan")
```

Plot histogram with overlaping normal curve and quantile-quantile plot for the US data.

```{r  message=FALSE}
# Plot histogram
hist_us<- ggplot (us, aes(MPG))+geom_histogram(aes(y=..density..),colour="black", fill = "white") + 
  stat_function(fun=dnorm, args = list (mean = mean(us$MPG), sd=sd(us$MPG)), colour = "red")
# Plot quantile-quantile plot
qq_us <- ggplot(us, aes(sample = MPG))+stat_qq()+stat_qq_line()
# Arrange two plots in one grid
grid.arrange(hist_us, qq_us, ncol=1, nrow=2)
```

Plot histogram with overlaping normal curve and quantile-quantile plot for the Japan data.

```{r  message=FALSE}
# Plot histogram
hist_jpn <- ggplot (japan, aes(MPG))+geom_histogram(aes(y=..density..),colour="black", fill = "white") + 
  stat_function(fun=dnorm, args = list (mean = mean(japan$MPG), sd=sd(japan$MPG)), colour = "red")
# Plot quantile-quantile plot
qq_jpn <- ggplot(japan, aes(sample = MPG))+stat_qq()+stat_qq_line()
# Arrange two plots in one grid
grid.arrange(hist_jpn, qq_jpn, ncol=1, nrow=2)
```

Based on the graphical methods, data does not fit normality well.

Apply goodness of fit test to the data:

```{r}
# Goodness of fit test
gofTest(us, distribution = "norm")
gofTest(japan, distribution = "norm")
```

Small p-values for both data mean that can reject the null hypothesis (the data is consistent with normal distribution) and both data sets 
are not consistent with Normal distribution.

## 1.4. Preferable test for selected dataset




# Second part



```{r}
get_power <- function (n1, n2) {
  
  alpha = 0.05
  N = 1000
  mu_1 = -5
  mu_2 = 0
  mu1_mu2 = -5
  
  mu_diffs <- c (-5, -1, 0, 1, 5)
  mu_1_all <- c (-5, -1, 0, 1, 5)
  pwr_eq_sigma <- c()
  pwr_noteq_sigma <- c()
  res <- data.frame(cbind(mu_1_all))
  var_all <- c (1,3,9)
  
  for (k in 1:length (var_all)) {
    
     pwr_eq_sigma <- c()
     pwr_noteq_sigma <- c()
     
     for (j in 1:length(mu_1_all)) {
     pvalues_eq <- c()
     pvalues_noteq <- c()
    
     A_sample <- as.data.frame ( replicate (N, rnorm (n1, mean = mu_1_all[j], 
                                                      sd = sqrt (var_all[k]))) )
     B_sample <- as.data.frame ( replicate (N, rnorm (n2, mean = 0, sd = sqrt (1))) )
        for (col in 1:ncol(A_sample)) {
           pvalues_eq <-append (pvalues_eq, t.test (A_sample[,col], B_sample[,col], 
                                            var.equal=TRUE, conf.level = 0.95)$p.value )
           pvalues_noteq <-append( pvalues_noteq, t.test (A_sample[,col], B_sample[,col], 
                                            var.equal=FALSE, conf.level = 0.95)$p.value ) }
           pwr_eq_sigma <- append (pwr_eq_sigma, sum (pvalues_eq < alpha)/N)
           pwr_noteq_sigma <-append (pwr_noteq_sigma,  sum (pvalues_noteq < alpha)/N )
        }
        res <- cbind(res, as.data.frame(cbind(pwr_eq_sigma,  pwr_noteq_sigma)))
  }
  names(res)<- c ("mu_dif", "pwr_eq_sigma1_1", "pwr_noteq_sigma1_1", 
                  "pwr_eq_sigma3_1", "pwr_noteq_sigma3_1", "pwr_eq_sigma9_1",
                  "pwr_noteq_sigma9_1")
  return (res)
}
  
data_n10_n10 <-get_power(10, 10)
data_n10_n25 <-get_power(10, 25)
data_n10_n60 <-get_power(10, 60)
data_n25_n10 <-get_power(25, 10)
data_n25_n25 <-get_power(25, 25)
data_n25_n60 <-get_power(25, 60)
data_n60_n10 <-get_power(60,10)
data_n60_n25 <-get_power(60, 25)
data_n60_n60 <-get_power(60, 60)



plot10_10<- ggplot ()+ geom_line (data = data_n10_n10, aes (x = mu_dif, 
                                  y = pwr_eq_sigma1_1, color = "Var1=1, Var2=1")) +
geom_line (data = data_n10_n10, aes (x = mu_dif, y = pwr_noteq_sigma1_1, 
                                  color = "Var1=1, Var2=1"), linetype="dotted") +
geom_line (data = data_n10_n10, aes (x = mu_dif, y = pwr_eq_sigma3_1, 
                                  color = "Var1=3, Var2=1")) +
geom_line (data = data_n10_n10, aes (x = mu_dif, y = pwr_noteq_sigma3_1, 
                                  color = "Var1=3, Var2=1"),  linetype="dotted")+
geom_line (data = data_n10_n10, aes (x = mu_dif, y = pwr_eq_sigma9_1, 
                                  color = "Var1=9, Var2=1")) +
geom_line (data = data_n10_n10, aes (x = mu_dif, y = pwr_noteq_sigma9_1, 
                                     color = "Var1=9, Var2=1"), linetype="dotted") +
scale_color_discrete("n1 = 10, n2 = 10")+xlab("Mu1-Mu2")+ylab("Power") 
 
plot10_25<- ggplot ()+ geom_line (data = data_n10_n25, aes (x = mu_dif, 
                                  y = pwr_eq_sigma1_1, color = "Var1=1, Var2 = 1")) +
geom_line (data = data_n10_n25, aes (x = mu_dif, y = pwr_noteq_sigma1_1, color = "Var1=1, Var2=1"), 
           linetype="dotted") +
geom_line (data = data_n10_n25, aes (x = mu_dif, y = pwr_eq_sigma3_1, color = "Var1=3, Var2=1")) +
geom_line (data = data_n10_n25, aes (x = mu_dif, y = pwr_noteq_sigma3_1, color = "Var1=3, Var2=1"),  
           linetype="dotted")+
geom_line (data = data_n10_n25, aes (x = mu_dif, y = pwr_eq_sigma9_1, color = "Var1=9, Var2=1")) +
geom_line (data = data_n10_n25, aes (x = mu_dif, y = pwr_noteq_sigma9_1, color = "Var1=9, Var2=1"),  
           linetype="dotted") +
scale_color_discrete("n1 = 10, n2 = 25")+xlab("Mu1-Mu2")+ylab("Power") 

plot10_60<- ggplot ()+ geom_line (data = data_n10_n60, aes (x = mu_dif, y = pwr_eq_sigma1_1,  
                                                            color = "Var1=1, Var2 = 1")) +
geom_line (data = data_n10_n60, aes (x = mu_dif, y = pwr_noteq_sigma1_1, color = "Var1=1, Var2=1"), 
           linetype="dotted") +
geom_line (data = data_n10_n60, aes (x = mu_dif, y = pwr_eq_sigma3_1, color = "Var1=3, Var2=1")) +
geom_line (data = data_n10_n60, aes (x = mu_dif, y = pwr_noteq_sigma3_1, color = "Var1=3, Var2=1"),  
           linetype="dotted")+
geom_line (data = data_n10_n60, aes (x = mu_dif, y = pwr_eq_sigma9_1, color = "Var1=9, Var2=1")) +
geom_line (data = data_n10_n60, aes (x = mu_dif, y = pwr_noteq_sigma9_1, color = "Var1=9, Var2=1"),  
           linetype="dotted") +
scale_color_discrete("n1 = 10, n2 = 60")+xlab("Mu1-Mu2")+ylab("Power") 

plot25_10 <-ggplot ()+ geom_line (data = data_n25_n10, aes (x = mu_dif, y = pwr_eq_sigma1_1,  color = "Var1=1, Var2 = 1")) +
           geom_line (data = data_n25_n10, aes (x = mu_dif, y = pwr_noteq_sigma1_1, color = "Var1=1, Var2=1"), linetype="dotted") +
           geom_line (data = data_n25_n10, aes (x = mu_dif, y = pwr_eq_sigma3_1, color = "Var1=3, Var2=1")) +
           geom_line (data = data_n25_n10, aes (x = mu_dif, y = pwr_noteq_sigma3_1, color = "Var1=3, Var2=1"),  linetype="dotted")+
           geom_line (data = data_n25_n10, aes (x = mu_dif, y = pwr_eq_sigma9_1, color = "Var1=9, Var2=1")) +
           geom_line (data = data_n25_n10, aes (x = mu_dif, y = pwr_noteq_sigma9_1, color = "Var1=9, Var2=1"),  linetype="dotted") +
scale_color_discrete("n1 = 25, n2 = 10")+xlab("Mu1-Mu2")+ylab("Power") 

plot25_25<-ggplot ()+ geom_line (data = data_n25_n25, aes (x = mu_dif, y = pwr_eq_sigma1_1,  color = "Var1=1, Var2 = 1")) +
           geom_line (data = data_n25_n25, aes (x = mu_dif, y = pwr_noteq_sigma1_1, color = "Var1=1, Var2=1"), linetype="dotted") +
           geom_line (data = data_n25_n25, aes (x = mu_dif, y = pwr_eq_sigma3_1, color = "Var1=3, Var2=1")) +
           geom_line (data = data_n25_n25, aes (x = mu_dif, y = pwr_noteq_sigma3_1, color = "Var1=3, Var2=1"),  linetype="dotted")+
           geom_line (data = data_n25_n25, aes (x = mu_dif, y = pwr_eq_sigma9_1, color = "Var1=9, Var2=1")) +
           geom_line (data = data_n25_n25, aes (x = mu_dif, y = pwr_noteq_sigma9_1, color = "Var1=9, Var2=1"),  linetype="dotted") +
scale_color_discrete("n1 = 25, n2 = 25")+xlab("Mu1-Mu2")+ylab("Power") 

plot25_60<-ggplot ()+ geom_line (data = data_n25_n60, aes (x = mu_dif, y = pwr_eq_sigma1_1,  color = "Var1=1, Var2 = 1")) +
           geom_line (data = data_n25_n60, aes (x = mu_dif, y = pwr_noteq_sigma1_1, color = "Var1=1, Var2=1"), linetype="dotted") +
           geom_line (data = data_n25_n60, aes (x = mu_dif, y = pwr_eq_sigma3_1, color = "Var1=3, Var2=1")) +
           geom_line (data = data_n25_n60, aes (x = mu_dif, y = pwr_noteq_sigma3_1, color = "Var1=3, Var2=1"),  linetype="dotted")+
           geom_line (data = data_n25_n60, aes (x = mu_dif, y = pwr_eq_sigma9_1, color = "Var1=9, Var2=1")) +
           geom_line (data = data_n25_n60, aes (x = mu_dif, y = pwr_noteq_sigma9_1, color = "Var1=9, Var2=1"),  linetype="dotted") +
scale_color_discrete("n1 = 25, n2 = 60")+xlab("Mu1-Mu2")+ylab("Power") 


plot60_10<-ggplot ()+ geom_line (data = data_n60_n10, aes (x = mu_dif, y = pwr_eq_sigma1_1,  color = "Var1=1, Var2 = 1")) +
           geom_line (data = data_n60_n10, aes (x = mu_dif, y = pwr_noteq_sigma1_1, color = "Var1=1, Var2=1"), linetype="dotted") +
           geom_line (data = data_n60_n10, aes (x = mu_dif, y = pwr_eq_sigma3_1, color = "Var1=3, Var2=1")) +
           geom_line (data = data_n60_n10, aes (x = mu_dif, y = pwr_noteq_sigma3_1, color = "Var1=3, Var2=1"),  linetype="dotted")+
           geom_line (data = data_n60_n10, aes (x = mu_dif, y = pwr_eq_sigma9_1, color = "Var1=9, Var2=1")) +
           geom_line (data = data_n60_n10, aes (x = mu_dif, y = pwr_noteq_sigma9_1, color = "Var1=9, Var2=1"),  linetype="dotted") +
scale_color_discrete("n1 = 60, n2 = 10")+xlab("Mu1-Mu2")+ylab("Power") 

plot60_25<-ggplot ()+ geom_line (data = data_n60_n25, aes (x = mu_dif, y = pwr_eq_sigma1_1,  color = "Var1=1, Var2 = 1")) +
           geom_line (data = data_n60_n25, aes (x = mu_dif, y = pwr_noteq_sigma1_1, color = "Var1=1, Var2=1"), linetype="dotted") +
           geom_line (data = data_n60_n25, aes (x = mu_dif, y = pwr_eq_sigma3_1, color = "Var1=3, Var2=1")) +
           geom_line (data = data_n60_n25, aes (x = mu_dif, y = pwr_noteq_sigma3_1, color = "Var1=3, Var2=1"),  linetype="dotted")+
           geom_line (data = data_n60_n25, aes (x = mu_dif, y = pwr_eq_sigma9_1, color = "Var1=9, Var2=1")) +
           geom_line (data = data_n60_n25, aes (x = mu_dif, y = pwr_noteq_sigma9_1, color = "Var1=9, Var2=1"),  linetype="dotted") +
scale_color_discrete("n1 = 60, n2 = 25")+xlab("Mu1-Mu2")+ylab("Power") 

plot60_60 <- ggplot ()+ geom_line (data = data_n60_n60, aes (x = mu_dif, y = pwr_eq_sigma1_1,  color = "Var1=1, Var2 = 1")) +
           geom_line (data = data_n60_n60, aes (x = mu_dif, y = pwr_noteq_sigma1_1, color = "Var1=1, Var2=1"), linetype="dotted") +
           geom_line (data = data_n60_n60, aes (x = mu_dif, y = pwr_eq_sigma3_1, color = "Var1=3, Var2=1")) +
           geom_line (data = data_n60_n60, aes (x = mu_dif, y = pwr_noteq_sigma3_1, color = "Var1=3, Var2=1"),  linetype="dotted")+
           geom_line (data = data_n60_n60, aes (x = mu_dif, y = pwr_eq_sigma9_1, color = "Var1=9, Var2=1")) +
           geom_line (data = data_n60_n60, aes (x = mu_dif, y = pwr_noteq_sigma9_1, color = "Var1=9, Var2=1"),  linetype="dotted") +
scale_color_discrete("n1 = 60, n2 = 60")+xlab("Mu1-Mu2")+ylab("Power") 


grid.arrange(plot10_10, plot10_25, plot10_60, ncol=1, nrow=3, 
left ="Dotted lines - Power for the Unequal Varince Test \n Solid lines - Power for Equal Variance Test") 
grid.arrange(plot25_10, plot25_25, plot25_60, ncol=1, nrow=3, 
left ="Dotted lines - Power for the Unequal Varince Test \n Solid lines - Power for Equal Variance Test")
grid.arrange(plot60_10, plot60_25, plot60_60, ncol=1, nrow=3, 
left ="Dotted lines - Power for the Unequal Varince Test \n Solid lines - Power for Equal Variance Test")
  
```


#Laura's code:

```{r}
# alpha = 0.05
# N = 1000
# n1 = c(10,25,60) 
# n2 = c(10,25,60)
# var1 = c(1,3,9)
# var2 = 1
# mu1 = 0 
# mu2 = c(-5,-1,0,1,5)
# 
# for (d in 1:length(n2)){
# for (c in 1:length(n1)){
# 
# for (b in 1:length(var1)){
#   
# tmp_pwr <- c()
# tmp_mu_diff <- c ()
# 
# tmp_pwr2 <- c()
# tmp_mu_diff2 <- c()
# 
# for (a in 1:length(mu2)){
# 
# #Equal Variances
# sample1<-replicate(N, rnorm(n1[c], mean=mu1, sd=sqrt(var1[b])))
# sample2<-replicate(N, rnorm(n2[d], mean=mu2[a], sd=sqrt(var2)))
# 
# pValues<-c()
# 
# for (i in 1:N){
#   pValues[i]<- t.test(sample1[,i], sample2[,i], var.equal = TRUE, conf.level = 0.95)$p.value
# }
# 
# accept <- 0
# cutoff <- alpha
# 
# for (i in 1:N){
#   if (pValues[i] <= cutoff){
#     accept <- accept + 1
#   }
# }
# 
# pwr <- accept/N
# 
# tmp_pwr <- append  (tmp_pwr, pwr)
# 
# #Unequal Variances
# pValues<-c()
# 
# for (i in 1:N){
#   pValues[i]<- t.test(sample1[,i], sample2[,i], var.equal = FALSE, conf.level = 0.95)$p.value
# }
# 
# accept <- 0
# cutoff <- alpha
# 
# for (i in 1:N){
#   if (pValues[i] <= cutoff){
#     accept <- accept + 1
#   }
# }
# 
# pwr2 <- accept/N
# 
# tmp_pwr2 <- append  (tmp_pwr2, pwr2)
# 
# }#end for a
# 
# title<-c("equal variance",var1[b], n1[c], n2[d])
# Title<-toString(title)
# plot(mu2, tmp_pwr, type = "l", main = Title)
# 
# title2<-c("unequal variance",var1[b], n1[c], n2[d])
# Title2<-toString(title2)
# plot(mu2, tmp_pwr2, type = "l", main = Title2)

#}#end for b
#}#end for c
#}#end for d
